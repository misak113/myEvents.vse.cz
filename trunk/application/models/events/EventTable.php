<?phpnamespace app\models\events;use My\Db\Table;/** * Trida reprezentujici seznam akci * */class EventTable extends Table {    /**     * Nazev databazove tabulky     *     * @var string     */    protected $_name = 'event';    /**     * Nazev tridy predstavujici jeden zaznam     *     * @var string     */    protected $_rowClass = 'app\models\events\Event';        /**     * @param int Id of event     * @return Row     */    public function getById($id) {        return $this->fetchRow(array('event_id = ?' => $id));    }    /**     * @return array     */    public function getEvents() {        $events = $this->select()                ->where('active = 1')                ->where('public = 1')                >fetchAll();        return $events;    }    /**     * Returns events in array from current week     * array[one day from week][]     * @return array Events from current week     */    public function getEventsThisWeek() {        $day = date('w', strtotime('now'));        $monday = date('Y-m-d 00:00:00', strtotime('last monday'));        $sunday = date('Y-m-d 23:59:59', strtotime('next sunday'));        if ($day == 0)            $sunday = date('Y-m-d 23:59:59', strtotime('today'));        if ($day == 1)            $monday = date('Y-m-d 00:00:00', strtotime('today'));        $where = $this->select()                ->where('timestart >= ?', $monday)                ->where('active = 1')                ->where('public = 1')        //    ->where('timestart <= ?',$sunday)        ;        $eventsRowSet = $this->fetchAll($where, 'timestart');        $eventsArray = $this->createEventDated($eventsRowSet);        return $eventsArray;    }    public function createEventDated($eventsRowSet) {        $eventsArray = array();        foreach ($eventsRowSet as $event) {            $date = date('d.m.Y', strtotime($event->timestart));            $eventsArray[$date][] = $event;        }        return $eventsArray;    }    /**     * Vraci rowset udalosti, ktere se konaji v rozmezi +- 2 hodiny     * @param String $datetime format Y-m-d H:i:s     */    public function getNearEvents($datetime) {        $timestamp = strtotime($datetime);        $range = 2 * 60 * 60;        $minTime = $timestamp - $range;        $maxTime = $timestamp + $range;        $where = $this->select(\Zend_Db_Table::SELECT_WITH_FROM_PART)                ->setIntegrityCheck(false)                ->where('timestart >= ? ', date("Y-m-d H:i:s", $minTime))                ->where('timestart <= ?', date("Y-m-d H:i:s", $maxTime))                ->where('public = 1')                ->where('active = 1')                ->join('organization_own_event', 'event.event_id = organization_own_event.event_id')                ->join('organization', 'organization_own_event.organization_id = organization.organization_id', array('organization_name' => 'organization.name'))                ->order('timestart');        return $this->fetchAll($where); //, 'timestart'    }}