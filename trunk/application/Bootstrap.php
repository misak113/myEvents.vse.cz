<?phpuse Zette\Diagnostics\TimerPanel;use Zette\Application\Route;/** * Uvodni inicializace aplikace * */class Bootstrap extends Zend_Application_Bootstrap_Bootstrap {	/** @var \Nette\DI\Container */	protected $context;	public function setResources($resources) {		$this->loadZette();		foreach ($resources as $resource => $resourceOptions) {			if ($resource == 'db') {				$resourceOptions = $this->configDatabase($resourceOptions);			}			$this->registerPluginResource($resource, $resourceOptions);		}	}	protected function loadZette() {		// ZetteLoader		Zend_Loader::loadClass('\Zette\DI\Loader');		$zetteLoader = new \Zette\DI\Loader();		$zetteLoader->load();		$this->context = $zetteLoader->getContext();		TimerPanel::traceTime('Zette loaded');	}	protected function configDatabase($options) {		$parameters = $this->context->getParameters();		$options['params']['host'] = $parameters['database']['host'];		$options['params']['username'] = $parameters['database']['username'];		$options['params']['password'] = $parameters['database']['password'];		$options['params']['dbname'] = $parameters['database']['dbname'];		return $options;	}	/**	 * @return Nette\DI\Container	 */	protected function _initContext() {		//#### Set Db profiler to Nette Debuger @todo to Zette library		/** @var \Zend_Application_Resource_Db $db  */		$db = $this->getPluginResource('db');		/** @var \Zette_Database_Pdo_Mysql $adapter  */		$adapter = $db->getDbAdapter();		$connectionPanel = $this->context->getService('zette.connectionPanel');		$adapter->setConnectionPanel($connectionPanel);		/** @var \Zette\Database\Diagnostics\ConnectionPanel $connectionPanel  */		$connectionPanel->setProfiler($adapter->getProfiler());		TimerPanel::traceTime();		return $this->context;	}	protected function _initSession() {		// @todo to Zette		try {			$this->context->getService('session')->start();			Zend_Session::$_unitTestEnabled = true;			Zend_Session::start();			Zend_Session::$_unitTestEnabled = false;		} catch (Exception $e) {}		TimerPanel::traceTime();	}	protected function _initView()	{		// LatteView		$context = $view = $this->getResource('context');		$viewLoader = new \Zette\Templating\Loader($context);		$view = $viewLoader->createView();		TimerPanel::traceTime();		return $view;	}	/**	 * Nastaveni helperu	 * @deprecated	 */	protected function _initHelpers() {		$view = $this->getResource('view');		$prefix = 'My_View_Helper';		$dir = APPLICATION_PATH . '/../library/My/View/Helper';		$view->addHelperPath($dir, $prefix);		TimerPanel::traceTime();	}	/**	 * Nastaveni prepisu URL	 *	 * @param array $options	 */	protected function _initRequest(array $options = array()) {		$this->bootstrap('FrontController');		/** @var Zend_Controller_Front $frontController  */		$frontController = $this->getResource('FrontController');		$frontController->throwExceptions(true); // @todo to Zette loader		$router = $frontController->getRouter();		// Statics		$router->addRoute('aboutUs', new Route('o-nas', array(				'module' => 'default',				'controller' => 'index',				'action' => 'about',			))		);		$router->addRoute('contact', new Route('kontakt', array(				'module' => 'default',				'controller' => 'index',				'action' => 'contact',			))		);		// Events		$router->addRoute('eventList', new Route('udalosti/:categoryId', array(				'module' => 'default',				'controller' => 'event',				'action' => 'list',				'categoryId' => '',			))		);		$router->addRoute('event', new Route('udalost/:id/:title', array(				'module' => 'default',				'controller' => 'event',				'action' => 'detail',			), array(				'id' => '\d+',			))		);                                // User accounts                $router->addRoute('userRegister', new Route('registrace', array(				'module' => 'default',				'controller' => 'index',				'action' => 'register',			))		);		$router->addRoute('userLogin', new Route('login', array(				'module' => 'admin',				'controller' => 'index',				'action' => 'login',			))		);		$router->addRoute('userLogout', new Route('administrace/logout', array(				'module' => 'admin',				'controller' => 'index',				'action' => 'logout',			))		);                                                // Admin		$router->addRoute('adminIndex', new Route('administrace', array(				'module' => 'admin',				'controller' => 'index',				'action' => 'index',			))		);		$router->addRoute('newEvent', new Route('administrace/nova-udalost', array(				'module' => 'admin',				'controller' => 'index',				'action' => 'edit',			))		);		$router->addRoute('editEvent', new Route('administrace/editovat-udalost/:id', array(				'module' => 'admin',				'controller' => 'index',				'action' => 'edit',			), array(                            'id' => '\d+',                        ))		);		// Landing page @todo smazat pro real pages		$router->addRoute('landing', new Route('', array(				'module' => 'landing',				'controller' => 'index',				'action' => 'index',			))		);		TimerPanel::traceTime();	}}